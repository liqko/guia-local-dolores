<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agenda - Eventos</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    /* Basado en el estilo de promociones pero adaptado para eventos */
    :root {
      --accent-1: #3b7dd8;
      --accent-2: #ff6a00;
      --bg-card: rgba(255,255,255,0.96);
      --vip-gradient: linear-gradient(120deg,#ff8c00 0%,#ffb347 40%,#a259ff 100%);
      --radius: 14px;
      --shadow: 0 6px 30px rgba(0,0,0,0.08);
    }
    html,body { height: 100%; margin:0; padding:0; font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg,#f6f8ff 0%, #eef6ff 100%); color:#1b2b46; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .wrap { max-width:1100px; margin: 26px auto; padding: 0 12px 60px; box-sizing:border-box; }
    .header { display:flex; align-items:center; gap:14px; justify-content:center; flex-wrap:wrap; margin-bottom:10px; }
    .main-logo { width:82px; height:82px; border-radius:12px; background:#fff; box-shadow:0 4px 22px rgba(30,50,90,0.06); object-fit:cover; }
    .title { font-size:1.9rem; font-weight:900; color:var(--accent-1); text-align:center; margin:0; }
    .subtitle { font-size:0.95rem; color:#36507a; text-align:center; margin-top:4px; margin-bottom:0; font-weight:600; }

    /* acciones superiores */
    .controls { display:flex; gap:14px; align-items:center; justify-content:center; flex-wrap:wrap; margin:14px 0 8px; }
    .search-box { width:360px; max-width:92%; padding:12px 14px; border-radius:12px; border:none; box-shadow:0 6px 18px rgba(3,49,133,0.04); font-size:1rem; }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    .tab { padding:8px 12px; border-radius:10px; background:#fff; border:1px solid rgba(16,40,80,0.06); cursor:pointer; font-weight:800; color:#234; }
    .tab.active { background:var(--accent-1); color:#fff; border-color:var(--accent-1); box-shadow:0 8px 28px rgba(59,125,216,0.14); transform:translateY(-1px); }

    .categories-bar { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin:12px 0 20px; }

    .category-chip { background:#fff; border-radius:12px; padding:8px 12px; border:1px solid rgba(30,50,90,0.04); cursor:pointer; font-weight:700; color:#1b2b46; }
    .category-chip.selected { background:#eef6ff; border-color:var(--accent-1); color:var(--accent-1); box-shadow:0 6px 18px rgba(59,125,216,0.06); }

    /* contenedor de tarjetas */
    .cards { display:flex; flex-direction:column; gap:20px; align-items:center; min-height:240px; }
    .card { width:100%; max-width:980px; background:var(--bg-card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; box-sizing:border-box; display:flex; gap:14px; flex-direction:column; }
    .card.compact { padding:12px; max-width:820px; }
    .card-row { display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; }
    .left { min-width:120px; max-width:220px; display:flex; flex-direction:column; gap:8px; align-items:center; }
    .logo { width:120px; height:120px; object-fit:cover; border-radius:12px; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,0.04); }
    .info { flex:1 1 420px; display:flex; flex-direction:column; gap:8px; }
    .event-title { font-size:1.25rem; font-weight:900; color:#172a4a; margin:0; }
    .meta { color:#254e78; font-weight:700; font-size:0.98rem; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .desc { color:#223249; font-size:0.98rem; text-align:justify; }

    /* VIP style */
    .vip { background: var(--vip-gradient); color: #fff; border:2px solid rgba(255,255,255,0.12); box-shadow: 0 16px 50px rgba(162,89,255,0.18); }
    .vip .event-title { color:#fff; text-shadow:0 2px 14px rgba(0,0,0,0.12); }
    .vip .meta { color: #fffbe6; }
    .vip .left .logo { width:180px; height:120px; border-radius:12px; }

    /* galería para VIP */
    .gallery { width:100%; display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:nowrap; margin-top:6px; }
    .gallery-main { width:100%; max-width:760px; height:320px; border-radius:12px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center; }
    .gallery-main img { width:100%; height:100%; object-fit:cover; display:block; }
    .gallery-thumbs { display:flex; gap:8px; margin-top:8px; justify-content:center; flex-wrap:wrap; }
    .thumb { width:84px; height:56px; border-radius:8px; overflow:hidden; border:2px solid rgba(255,255,255,0.2); cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
    .thumb img { width:100%; height:100%; object-fit:cover; display:block; }

    /* sponsors/partners */
    .partners { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:12px; padding-top:10px; border-top:1px dashed rgba(255,255,255,0.12); }
    .partner { display:flex; gap:8px; align-items:center; background:rgba(255,255,255,0.08); padding:6px 10px; border-radius:10px; }
    .partner img { width:48px; height:48px; object-fit:contain; border-radius:8px; background:#fff; padding:6px; }

    /* compact card specifics */
    .compact .compact-left { width:76px; height:76px; border-radius:10px; overflow:hidden; }
    .compact .compact-title { font-size:1.06rem; font-weight:800; color:#133150; }
    .compact .compact-meta { font-size:0.92rem; color:#3a5f86; font-weight:700; }

    /* acciones */
    .actions { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    .btn { padding:10px 14px; border-radius:10px; background:var(--accent-1); color:#fff; border:none; cursor:pointer; font-weight:800; text-decoration:none; display:inline-flex; gap:8px; align-items:center; }
    .btn.secondary { background:#fff; color:var(--accent-1); border:1px solid rgba(30,50,90,0.06); }

    /* paginator */
    .paginator { display:flex; justify-content:center; gap:10px; margin-top:18px; align-items:center; }
    .paginator button { padding:8px 12px; border-radius:8px; border:none; background:var(--accent-1); color:#fff; cursor:pointer; font-weight:800; }

    @media (max-width:900px) {
      .gallery-main { height:220px; }
      .vip .left .logo { width:140px; height:96px; }
    }
    @media (max-width:600px) {
      .left { min-width:100%; align-items:flex-start; flex-direction:row; gap:10px; }
      .logo { width:96px; height:96px; }
      .gallery-main { height:180px; }
      .thumb { width:64px; height:44px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <img class="main-logo" id="mainLogo" src="https://res.cloudinary.com/dw3oovvb1/image/upload/v1761321331/dq3bwgffteoqkeesxsuy.png" alt="Logo eventos">
      <div style="text-align:center">
        <h1 class="title">Agenda de Eventos</h1>
        <div class="subtitle">Explorá cursos, conciertos, actividades y más — pestañas para los distintos niveles</div>
      </div>
    </div>

    <div class="controls">
      <input id="search" class="search-box" placeholder="Buscar por nombre, categoría, organizador, lugar..." />
      <div id="tabs" class="tabs" aria-label="Pestañas de niveles"></div>
    </div>

    <div id="categoriesBar" class="categories-bar"></div>

    <div id="cards" class="cards"></div>

    <div id="paginator" class="paginator"></div>
  </div>

  <script>
    // URL de la hoja (usamos gid para apuntar exactamente a la hoja indicada)
    const SHEET_GVIZ = "https://docs.google.com/spreadsheets/d/1CCNDvrIFFufiLXmYkm4YcmtZVpk6rG2gJQQYXzA186o/gviz/tq?tqx=out:json&gid=338324539";

    // Paginación
    const ITEMS_PER_PAGE = 8;
    let events = [];
    let filtered = [];
    let currentPage = 1;
    let categoriesSet = new Set();
    let nivelesSet = new Set();
    let activeNivel = 'Todos';
    let activeCategory = '';
    let searchQ = '';

    // Utilities
    function safeText(s){ return s === null || s === undefined ? '' : String(s); }
    function escapeHtml(text) {
      if (text === null || text === undefined) return '';
      return String(text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }
    function safeUrl(u) {
      if (!u) return '';
      let s = String(u).trim();
      if (!s) return '';
      if (/^https?:\/\//i.test(s)) return s;
      if (/^www\./i.test(s)) return 'https://' + s;
      if (/^mailto:/i.test(s) || /^tel:/i.test(s)) return s;
      return 'https://' + s;
    }
    function isApproved(v) {
      if (!v) return false;
      const s = String(v).toLowerCase().trim();
      return ["si","sí","true","ok","✓","1","aprobado"].includes(s);
    }
    function fechaHumana(valor) {
      if (!valor) return "";
      // intenta varios formatos comunes
      if (/^\d{4}-\d{2}-\d{2}$/.test(valor)) {
        const [y,m,d] = valor.split("-");
        const date = new Date(Number(y), Number(m)-1, Number(d));
        const meses = ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];
        return `${date.getDate()} de ${meses[date.getMonth()]} de ${date.getFullYear()}`;
      }
      if (/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.test(valor)) {
        const m = valor.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
        const d = Number(m[1]), mm = Number(m[2]), y = Number(m[3]);
        const date = new Date(y, mm-1, d);
        const meses = ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];
        return `${date.getDate()} de ${meses[date.getMonth()]} de ${date.getFullYear()}`;
      }
      return valor;
    }
    function horaHumana(h) {
      if (!h) return "";
      if (/^\d{1,2}:\d{2}(:\d{2})?$/.test(h)) {
        const m = h.match(/^(\d{1,2}):(\d{2})/);
        return `${String(m[1]).padStart(2,'0')}:${m[2]} hs`;
      }
      // Date(...) pattern de Google Sheets
      let m = h.match(/^Date\(\d{4},\d{1,2},\d{1,2},(\d{1,2}),(\d{1,2})/);
      if (m) return `${String(m[1]).padStart(2,'0')}:${String(m[2]).padStart(2,'0')} hs`;
      return h;
    }

    // Adaptador: mapea columna por índice según estructura que enviaste
    // Indices basados en: aprobado(0)	nivel(1)	evento_id(2)	id_anunciante(3)	organizador(4)	logo_organizador(5)	categoria(6)	logo_categoria(7)	nombre_evento(8)	localidad(9)	lugar(10)	direccion(11)	llegar(12)	fecha(13)	hora(14)	hora2(15)	descripcion(16)	instagram(17)	img1(18)	img2(19)	img3(20)	entradas(21)	partner(22)	logo_partner(23)	partner2(24)	logo_partner2(25)	partner3(26)	logo_partner3(27)	partner4(28)	logo_partner4(29)	partner5(30)	logo_partner5(31)	partner6(32)	logo_partner6(33)	audit(34)
    function adaptarFila(c) {
      function v(idx){ return c[idx] && c[idx].v !== undefined ? c[idx].v : ''; }
      const partners = [];
      for (let i=22;i<=32;i+=2){
        const name = v(i);
        const logo = v(i+1);
        if ((name && String(name).trim()) || (logo && String(logo).trim())) {
          partners.push({ name: String(name||'').trim(), logo: String(logo||'').trim() });
        }
      }
      return {
        aprobado: v(0),
        nivel: String(v(1)||'').trim(),
        evento_id: v(2),
        id_anunciante: v(3),
        organizador: String(v(4)||'').trim(),
        logo_organizador: String(v(5)||'').trim(),
        categoria: String(v(6)||'').trim(),
        logo_categoria: String(v(7)||'').trim(),
        nombre: String(v(8)||'').trim(),
        localidad: String(v(9)||'').trim(),
        lugar: String(v(10)||'').trim(),
        direccion: String(v(11)||'').trim(),
        llegar: String(v(12)||'').trim(),
        fecha: String(v(13)||'').trim(),
        fecha_humana: fechaHumana(String(v(13)||'')),
        hora: String(v(14)||'').trim(),
        hora2: String(v(15)||'').trim(),
        descripcion: String(v(16)||'').trim(),
        instagram: String(v(17)||'').trim(),
        imgs: [String(v(18)||'').trim(), String(v(19)||'').trim(), String(v(20)||'').trim()].filter(s=>s),
        entradas: String(v(21)||'').trim(),
        partners: partners,
        audit: v(34)
      };
    }

    // Cargar datos desde Google Sheets (gviz)
    function loadData() {
      fetch(SHEET_GVIZ).then(r=>r.text()).then(text=>{
        try {
          // format: /*O_o*/google.visualization.Query.setResponse({...});
          const jsonText = text.substr(text.indexOf('{'), text.lastIndexOf('}') - text.indexOf('{') + 1);
          const obj = JSON.parse(jsonText);
          const rows = (obj.table && obj.table.rows) ? obj.table.rows : [];
          events = [];
          categoriesSet = new Set(); nivelesSet = new Set();
          for (let i=0;i<rows.length;i++){
            const c = rows[i].c;
            if (!c) continue;
            const aprobado = c[0] && c[0].v !== undefined ? c[0].v : '';
            if (!isApproved(aprobado)) continue;
            const ev = adaptarFila(c);
            // descartar vacíos sustanciales
            if (!ev.nombre && !ev.organizador) continue;
            events.push(ev);
            if (ev.categoria) categoriesSet.add(ev.categoria);
            if (ev.nivel) nivelesSet.add(ev.nivel);
          }
          // ordenar por fecha si existe
          events.sort((a,b)=>{
            const fa = a.fecha ? toISO(a.fecha) : '';
            const fb = b.fecha ? toISO(b.fecha) : '';
            return fa.localeCompare(fb);
          });
          // Inicializar filtros
          nivelesSet = new Set(Array.from(nivelesSet).sort((x,y)=>String(x).localeCompare(String(y))));
          nivelesSet = new Set(['Todos', ...Array.from(nivelesSet)]);
          filtered = events.slice();
          currentPage = 1;
          renderTabs();
          renderCategoriesBar();
          renderCards();
          renderPaginator();
        } catch(e){
          showError('Error parseando la hoja: ' + e.message);
          console.error(e);
        }
      }).catch(err=>{
        showError('No se pudieron cargar los eventos: ' + err);
        console.error(err);
      });
    }

    function toISO(str){
      if (!str) return '';
      if (/^\d{4}-\d{2}-\d{2}$/.test(str)) return str;
      const m = String(str).match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
      if (m) return `${m[3]}-${m[2].padStart(2,'0')}-${m[1].padStart(2,'0')}`;
      return str;
    }

    function showError(msg){
      const cards = document.getElementById('cards');
      cards.innerHTML = `<p style="color:#b02a2a;font-weight:800">${escapeHtml(msg)}</p>`;
    }

    // Render de pestañas (niveles)
    function renderTabs(){
      const tabs = document.getElementById('tabs');
      tabs.innerHTML = '';
      Array.from(nivelesSet).forEach(n=>{
        const btn = document.createElement('button');
        btn.className = 'tab' + (n === activeNivel ? ' active' : '');
        btn.textContent = n;
        btn.onclick = ()=>{
          activeNivel = n;
          activeCategory = '';
          document.getElementById('search').value = '';
          applyFilters();
          renderTabs();
        };
        tabs.appendChild(btn);
      });
    }

    // Render de categories
    function renderCategoriesBar(){
      const bar = document.getElementById('categoriesBar');
      bar.innerHTML = '';
      const cats = Array.from(categoriesSet).sort((a,b)=>String(a).localeCompare(String(b)));
      if (cats.length === 0) return;
      cats.forEach(cat=>{
        const b = document.createElement('button');
        b.className = 'category-chip' + (cat === activeCategory ? ' selected' : '');
        b.textContent = cat;
        b.onclick = ()=>{
          activeCategory = (activeCategory === cat ? '' : cat);
          document.getElementById('search').value = '';
          applyFilters();
          renderCategoriesBar();
        };
        bar.appendChild(b);
      });
      if (activeCategory) {
        const clear = document.createElement('button');
        clear.className = 'category-chip';
        clear.style.background = '#fff';
        clear.textContent = 'Limpiar categoría';
        clear.onclick = ()=>{ activeCategory=''; applyFilters(); renderCategoriesBar(); };
        bar.insertBefore(clear, bar.firstChild);
      }
    }

    // Aplicar filtros: nivel, categoria y búsqueda
    function applyFilters(){
      const q = (searchQ||'').trim().toLowerCase();
      filtered = events.filter(ev=>{
        if (activeNivel && activeNivel !== 'Todos') {
          if (!ev.nivel) return false;
          if (String(ev.nivel).toLowerCase() !== String(activeNivel).toLowerCase()) return false;
        }
        if (activeCategory) {
          if (!ev.categoria) return false;
          if (String(ev.categoria).toLowerCase() !== String(activeCategory).toLowerCase()) return false;
        }
        if (!q) return true;
        const hay = [
          ev.nombre, ev.categoria, ev.organizador, ev.lugar, ev.direccion, ev.descripcion, ev.localidad
        ].join(' ').toLowerCase();
        return hay.indexOf(q) !== -1;
      });
      currentPage = 1;
      renderCards();
      renderPaginator();
    }

    // Render de tarjetas (VIP con galería, Free compacto)
    function renderCards(){
      const container = document.getElementById('cards');
      container.innerHTML = '';
      const start = (currentPage-1)*ITEMS_PER_PAGE;
      const pageData = filtered.slice(start, start + ITEMS_PER_PAGE);

      if (pageData.length === 0){
        container.innerHTML = `<p style="color:#b02a2a;font-weight:800">No hay eventos para mostrar con ese criterio.</p>`;
        return;
      }

      pageData.forEach((ev, idx) => {
        const lvl = String(ev.nivel||'').toLowerCase();
        const isVIP = lvl === 'vip' || lvl === 'v.i.p' || lvl === 'v i p';
        const card = document.createElement('div');
        card.className = 'card' + (isVIP ? ' vip' : ' compact');

        // Contenido base
        if (isVIP) {
          // VIP: gran despliegue con galería + descripción + partners abajo
          const imgs = ev.imgs && ev.imgs.length ? ev.imgs.map(i=>safeUrl(i)).filter(Boolean) : [];
          const mainImg = imgs.length ? imgs[0] : (ev.logo_organizador ? safeUrl(ev.logo_organizador) : '');
          const galleryId = 'gallery-main-' + (Math.random()*100000|0);

          let partnersHtml = '';
          if (ev.partners && ev.partners.length) {
            partnersHtml = `<div class="partners">` + ev.partners.map(p=>{
              const l = safeUrl(p.logo);
              return `<div class="partner"><img src="${l||''}" alt="${escapeHtml(p.name)}" onerror="this.style.display='none'"/>${p.name ? `<strong style="margin-left:6px">${escapeHtml(p.name)}</strong>` : ''}</div>`;
            }).join('') + `</div>`;
          }

          card.innerHTML = `
            <div class="card-row">
              <div class="left">
                <img class="logo" src="${safeUrl(ev.logo_organizador)||''}" alt="${escapeHtml(ev.organizador)}" onerror="this.style.display='none'">
                <div style="text-align:center;font-weight:800;color:inherit">${escapeHtml(ev.organizador)}</div>
                ${ev.categoria ? `<div style="margin-top:6px">${ev.categoria ? `<span style="background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:10px;font-weight:800">${escapeHtml(ev.categoria)}</span>` : ''}</div>` : ''}
              </div>
              <div class="info">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap">
                  <div>
                    <div class="event-title">${escapeHtml(ev.nombre)}</div>
                    <div class="meta">
                      ${ev.fecha_humana ? `<span><i class="ri-calendar-event-line"></i> ${escapeHtml(ev.fecha_humana)}</span>` : ''}
                      ${ev.hora ? `<span><i class="ri-time-line"></i> ${escapeHtml(horaHumana(ev.hora||ev.hora2))}</span>` : ''}
                      ${ev.lugar ? `<span><i class="ri-map-pin-line"></i> ${escapeHtml(ev.lugar)}</span>` : ''}
                    </div>
                  </div>
                  <div style="text-align:right">
                    ${ev.entradas ? `<a class="btn" href="${safeUrl(ev.entradas)}" target="_blank" rel="noopener"><i class="ri-ticket-line"></i> Entradas</a>` : ''}
                  </div>
                </div>

                <div class="gallery" id="gallery-${galleryId}">
                  <div style="width:100%">
                    <div class="gallery-main" id="${galleryId}">
                      ${mainImg ? `<img src="${mainImg}" alt="Imagen principal">` : `<div style="padding:20px;color:rgba(0,0,0,0.2)">Sin imagen</div>`}
                    </div>
                    ${imgs.length > 1 ? `<div class="gallery-thumbs">${imgs.map((im,ii)=>`<div class="thumb" data-gallery="${galleryId}" data-index="${ii}"><img src="${im}" alt="thumb-${ii}" onerror="this.style.display='none'"></div>`).join('')}</div>` : ''}
                  </div>
                </div>

                <div class="desc">${escapeHtml(ev.descripcion || '').replace(/\n/g,'<br>')}</div>

                ${partnersHtml}
              </div>
            </div>
          `;

          // attach gallery interactions after append
          container.appendChild(card);
          if (imgs.length > 1) {
            const mainEl = card.querySelector(`#${galleryId} img`);
            const thumbs = card.querySelectorAll(`.thumb[data-gallery="${galleryId}"]`);
            thumbs.forEach(t=>{
              t.addEventListener('click', ()=> {
                const i = Number(t.getAttribute('data-index'));
                if (imgs[i]) mainEl.src = imgs[i];
              });
            });
          }
        } else {
          // Compact card (free/basic or standard)
          card.innerHTML = `
            <div class="card-row">
              <div class="compact-left" style="min-width:76px;display:flex;align-items:center;justify-content:center">
                <img src="${safeUrl(ev.logo_organizador)|| (ev.imgs[0] ? safeUrl(ev.imgs[0]) : '')}" alt="${escapeHtml(ev.organizador||ev.nombre)}" style="width:76px;height:76px;object-fit:cover;border-radius:10px;" onerror="this.style.display='none'">
              </div>
              <div class="info" style="padding-right:8px;">
                <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
                  <div>
                    <div class="compact-title">${escapeHtml(ev.nombre)}</div>
                    <div class="compact-meta">${ev.fecha_humana ? escapeHtml(ev.fecha_humana) : ''} ${ev.hora? ' • ' + escapeHtml(horaHumana(ev.hora||ev.hora2)) : ''} ${ev.lugar? ' • ' + escapeHtml(ev.lugar) : ''}</div>
                  </div>
                  <div style="display:flex;gap:8px;align-items:center">
                    ${ev.entradas ? `<a class="btn" href="${safeUrl(ev.entradas)}" target="_blank" rel="noopener"><i class="ri-ticket-line"></i></a>` : ''}
                    ${ev.instagram ? `<a class="btn secondary" href="${safeUrl(ev.instagram)}" target="_blank" rel="noopener"><i class="ri-instagram-line"></i></a>` : ''}
                  </div>
                </div>
                <div class="desc" style="margin-top:8px;max-height:86px;overflow:hidden">${escapeHtml(ev.descripcion||'').slice(0,550)}</div>
              </div>
            </div>
          `;
          container.appendChild(card);
        }
      });
    }

    // Paginador
    function renderPaginator(){
      const pag = document.getElementById('paginator');
      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / ITEMS_PER_PAGE));
      if (totalPages <= 1) { pag.innerHTML = ''; return; }
      pag.innerHTML = '';
      const prev = document.createElement('button');
      prev.textContent = 'Anterior';
      prev.disabled = currentPage <= 1;
      prev.onclick = ()=> { if (currentPage>1) { currentPage--; renderCards(); renderPaginator(); window.scrollTo({top:0,behavior:'smooth'}); } };
      const next = document.createElement('button');
      next.textContent = 'Siguiente';
      next.disabled = currentPage >= totalPages;
      next.onclick = ()=> { if (currentPage<totalPages) { currentPage++; renderCards(); renderPaginator(); window.scrollTo({top:0,behavior:'smooth'}); } };
      const info = document.createElement('div');
      info.style.fontWeight='800';
      info.textContent = `Página ${currentPage} / ${totalPages}`;
      pag.appendChild(prev);
      pag.appendChild(info);
      pag.appendChild(next);
    }

    // Bind search
    document.getElementById('search').addEventListener('input', function(e){
      searchQ = this.value || '';
      // limpiar categoría si se busca texto para evitar confundir resultados
      // pero no tocar pestaña de nivel
      activeCategory = '';
      applyFilters();
      renderCategoriesBar();
    });

    // Inicializar
    loadData();
  </script>
</body>
</html>
