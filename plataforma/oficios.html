<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Oficios</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {font-family:'Segoe UI','Roboto',Arial,sans-serif;font-style:italic;background:transparent;margin:0;color:#333;}
    .header {display:flex;align-items:center;padding:1rem;color:#006699;background-color:#f5e1d4;}
    .header img {height:60px;margin-right:0.75rem;}
    .header h1 {margin:0;font-size:2.2rem;font-weight:bold;letter-spacing:2px;text-transform:none;font-family:'Segoe UI','Roboto',Arial,sans-serif;line-height:1.1;}
    @media (max-width:900px){.header h1{font-size:1.5rem;}.header img{height:40px;}}
    .buscador, .buscador-tags{display:flex;gap:0.5rem;flex-wrap:wrap;padding:1rem;background:#f5e1d4;}
    .buscador select,.buscador input,.buscador-tags input{padding:0.5rem;border-radius:0.5rem;border:1px solid #ccc;font-family:'Segoe UI','Roboto',Arial,sans-serif;font-size:1em;}
    .buscador-tags {border-bottom: 1px solid #dcb;}
    .no-tags-msg {padding: 1.5em 1em 0 1em; color: #c00; font-weight: bold; font-size:1.1em;}
    .paginacion-zocalo{display:flex;justify-content:center;align-items:center;background:#f5e1d4;border-radius:1.5em;padding:0.7em;margin:1.5em auto;width:fit-content;min-width:280px;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
    .pagination-bar{display:inline-block;vertical-align:middle;margin:0 10px;background:#eaf0ea;border-radius:1.5em;padding:0.5em 1.2em;font-family:'Segoe UI','Roboto',Arial,sans-serif;font-size:1.05em;}
    .pagination-bar button,.pagination-bar span{margin:0 2px;padding:4px 12px;border:none;background:none;border-radius:4px;cursor:pointer;font-family:'Segoe UI','Roboto',Arial,sans-serif;font-size:1em;}
    .pagination-bar span.active{background:#006699;color:#fff;border:none;cursor:default;font-weight:bold;}
    .pagination-bar button[disabled]{opacity:0.5;cursor:not-allowed;}
    .pagination-bar button:hover:not([disabled]),.pagination-bar button:focus{background:#f5e1d4;color:#006699;outline:none;}
    .pagination-bar span{color:#444;font-weight:500;}
    .pagination-bar span.dots{cursor:default;background:none !important;color:#aaa;padding:4px 6px;}
    .grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));padding:1rem;}
    .destacadas-bar{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));padding:1rem 1rem 0 1rem;}
    .destacadas-bar .card{border:3px solid #d35400 !important;background:#ff7f50 !important;margin-bottom:0.5rem;color:#fff !important;}
    .card{padding:1rem;border-radius:0.75rem;box-shadow:0 2px 6px rgba(0,0,0,0.1);background:#fff;position:relative;font-family:'Segoe UI','Roboto',Arial,sans-serif;display:flex;flex-direction:column;min-height:200px;}
    .nivel-1{background:#f5e1d4;}
    .nivel-2{background:#00b0b9;color:white;}
    .nivel-3{background:#d6a77a;}
    .nivel-4{background:#b3e0ff;color:#222;border:2px solid #007bff;}
    .nivel-5{background:#ffe7dc;color:#222;border:3px solid #ff7f50;}
    .logo-comercio{max-width:110px;max-height:110px;object-fit:contain;border-radius:0.6rem;background:#fff;border:1px solid #eee;margin-right:1em;margin-top:0.1em;flex-shrink:0;display:block;}
    .card .nombre{font-weight:bold;font-size:1.1rem;color:#222;margin-bottom:0.5em;margin-top:0.05em;text-align:left;}
    .cat-line { display: none !important; }
    .subcat-line { display: none !important; }
    .descripcion { font-size:0.95rem; color:#333; margin-bottom:0.5em; margin-top:0.5em; width:100%; text-align:justify; white-space:pre-line; }
    .adicionales { font-size:0.93rem; color:#333; margin-bottom:0.5em; margin-top:0.5em; width:100%; text-align:left;}
    .spacer-under-subcat{height:1rem;width:100%;display:block;}
    .galeria-carrusel{display:flex;overflow-x:auto;gap:0.5rem;margin:1rem 0 0.5rem 0;-webkit-overflow-scrolling:touch;width:100%;justify-content:flex-start;}
    .galeria-carrusel img.thumbnail{flex:0 0 auto;width:120px;height:100px;object-fit:cover;border-radius:0.5rem;cursor:pointer;transition:transform 0.2s;}
    .galeria-carrusel img.thumbnail:hover{transform:scale(1.05);}
    .card img.thumbnail.solo{width:100%;height:220px;max-width:100%;max-height:280px;object-fit:contain;border-radius:0.5rem;margin:1rem 0 0.5rem 0;cursor:pointer;transition:transform 0.2s;display:block;}
    .card img.thumbnail:not(.solo){max-width:100%;height:100px;object-fit:cover;border-radius:0.5rem;margin:1rem 0 0.5rem 0;cursor:pointer;transition:transform 0.2s;display:block;}
    .termales-logo-container{display:flex;justify-content:center !important;align-items:center;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.5rem;margin-top:0.5rem;width:100%;}
    .termales-logo{max-width:150px;height:auto;display:inline-block;background:#fff;border-radius:0.6rem;border:1px solid #eee;padding:0.1em 0.1em;}
    @media (max-width:600px){.termales-logo{max-width:100px;display:block;}.logo-comercio{max-width:75px;max-height:75px;}.card img.thumbnail.solo{height:140px;max-height:180px;}}
    .contacto-bloque,.redes-bloque,.web-bloque,.mail-bloque{margin-top:0.7em;margin-bottom:0.4em;width:100%;text-align:left;}
    .contacto-bloque > div,.redes-bloque > div,.web-bloque > div,.mail-bloque > div{margin-bottom:0.2em;}
    .redes-bloque{margin-top:0.5em;margin-bottom:0.1em;}
    .web-bloque,.mail-bloque{margin-bottom:0.1em;}
    .badge-icons{position:absolute;top:8px;right:8px;display:flex;gap:4px;z-index:1;}
    .badge-icons img{height:40px;width:auto;}
    body.modal-open{overflow:hidden;}
    .leyenda-nivel-4{background:#c00;color:#fff;font-weight:bold;text-align:center;padding:0.3em 0.5em;border-radius:0.5em;margin-top:1em;letter-spacing:1px;}
    .leyenda-nivel-5{background:#fff;color:#ff7f50;font-weight:bold;text-align:center;padding:0.3em 0.5em;border-radius:0.5em;margin-top:1em;border:2px solid #ff7f50;letter-spacing:1px;}
    .modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);align-items:center;justify-content:center;}
    .modal.show{display:flex !important;}
    .modal-content{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;max-width:100vw;max-height:100vh;position:relative;}
    .modal-content img{max-width:90vw;max-height:80vh;border-radius:8px;box-shadow:0 2px 12px #000b;margin:0 auto;display:block;}
    .modal-close{position:absolute;top:20px;right:30px;font-size:2.5rem;color:#fff;cursor:pointer;z-index:10000;font-weight:bold;background:none;border:none;}
    @media (max-width:600px){.modal-content{justify-content:flex-start;align-items:center;padding-top:30px;}.modal-content img{max-width:98vw;max-height:55vh;margin-top:0;margin-bottom:auto;}.modal-close{top:12px;right:16px;font-size:2rem;}}
    .top-button{position:fixed;bottom:30px;right:30px;z-index:2000;background:#fff;color:#006699;font-size:2rem;padding:0.45em 0.55em;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.14);border:none;cursor:pointer;display:none;align-items:center;justify-content:center;transition:background 0.15s;}
    .top-button:hover{background:#f5e1d4;}
  </style>
</head>
<body>
  <header class="header" id="titulo-principal">
    <img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/oficios.png" />
    <h1>Oficios</h1>
  </header>
  <div class="buscador-tags">
    <input type="text" id="buscadorTags" placeholder="Buscar por palabras clave (ej: remera, swimmer, etc)" style="flex:1;"/>
  </div>
  <div class="no-tags-msg" id="noTagsMsg" style="display:none">
    No encontramos resultados por tags. Probá el buscador convencional de abajo para filtrar por nombre, categoría o subcategoría.
  </div>
  <div class="buscador">
    <select id="selectCategoria">
      <option value="">Todas las categorías</option>
    </select>
    <select id="selectSubcategoria">
      <option value="">Todas las subcategorías</option>
    </select>
    <input type="text" id="filtro" placeholder="Buscar por nombre..." />
  </div>
  <div class="destacadas-bar" id="destacadasBar"></div>
  <div class="grid" id="contenedor"></div>
  <div class="paginacion-zocalo" id="paginador-abajo">
    <button onclick="cambiarPagina('prev')" id="btnAnterior" disabled>Anterior</button>
    <span id="paginationBar" class="pagination-bar"></span>
    <button onclick="cambiarPagina('next')" id="btnSiguiente">Siguiente</button>
  </div>
  <div id="modal" class="modal">
    <span class="modal-close" id="modalClose" aria-label="Cerrar modal" role="button" tabindex="0">&times;</span>
    <div class="modal-content" id="modalImgContainer"></div>
  </div>
  <button id="topBtn" class="top-button" aria-label="Volver arriba" title="Volver arriba" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">↑</button>
  <script>
    const url = 'https://opensheet.elk.sh/170kTZ-ViCPxPli86g-n_XMuMv1S3O0-DbGwNFGYVnjY/1';
    fetch(url)
      .then(res => res.json())
      .then(data => {
        const filtro = document.getElementById('filtro');
        const buscadorTags = document.getElementById('buscadorTags');
        const contenedor = document.getElementById('contenedor');
        const destacadasBar = document.getElementById('destacadasBar');
        const modal = document.getElementById('modal');
        const modalImgContainer = document.getElementById('modalImgContainer');
        const modalClose = document.getElementById('modalClose');
        const selectCategoria = document.getElementById('selectCategoria');
        const selectSubcategoria = document.getElementById('selectSubcategoria');
        const paginationBar = document.getElementById('paginationBar');
        const btnAnterior = document.getElementById('btnAnterior');
        const btnSiguiente = document.getElementById('btnSiguiente');
        const noTagsMsg = document.getElementById('noTagsMsg');
        const normalizar = texto => texto.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");

        const turismoData = data.filter(item => {
          const rubros = [
            ...(item.rubro1 ? item.rubro1.split(',').map(r => r.trim().toLowerCase()) : []),
            ...(item.rubro2 ? item.rubro2.split(',').map(r => r.trim().toLowerCase()) : [])
          ];
          return rubros.includes('oficios');
        });

        const categoriasUnicas = [...new Set(
          turismoData.flatMap(item => {
            const r1 = item.rubro1 ? item.rubro1.split(',').map(r => r.trim()) : [];
            const r2 = item.rubro2 ? item.rubro2.split(',').map(r => r.trim()) : [];
            return [...r1, ...r2];
          }).filter(Boolean)
        )].sort();

        selectCategoria.innerHTML = '<option value="">Todas las categorías</option>' +
          categoriasUnicas.map(cat => `<option value="${cat}">${cat}</option>`).join('');

        function actualizarSubcategorias() {
          const catSeleccionada = selectCategoria.value;
          let subcats;
          if (catSeleccionada === '') {
            subcats = turismoData.flatMap(item => item.subcategoria1 ? item.subcategoria1.split(',').map(s => s.trim()) : []);
          } else {
            subcats = turismoData
              .filter(item =>
                (item.rubro1 && item.rubro1.split(',').map(r => r.trim()).includes(catSeleccionada)) ||
                (item.rubro2 && item.rubro2.split(',').map(r => r.trim()).includes(catSeleccionada))
              )
              .flatMap(item => item.subcategoria1 ? item.subcategoria1.split(',').map(s => s.trim()) : []);
          }
          const subcategoriasFiltradas = [...new Set(subcats)].sort();
          selectSubcategoria.innerHTML = '<option value="">Todas las subcategorías</option>' +
            subcategoriasFiltradas.map(sub => `<option value="${sub}">${sub}</option>`).join('');
        }

        selectCategoria.addEventListener('change', () => {
          actualizarSubcategorias();
          paginaActual = 1;
          render();
        });

        selectSubcategoria.addEventListener('change', () => {
          paginaActual = 1;
          render();
        });

        actualizarSubcategorias();

        const mostrarModal = (src) => {
          modalImgContainer.innerHTML = `<img src="${src}" alt="Imagen ampliada" />`;
          modal.classList.add('show');
          document.body.classList.add('modal-open');
          if (window.innerWidth <= 600) {
            setTimeout(() => {
              modal.scrollTop = 0;
              window.scrollTo({ top: 0, behavior: 'auto' });
            }, 50);
          }
        };
        window.mostrarModal = mostrarModal;

        modalClose.addEventListener('click', () => {
          modal.classList.remove('show');
          modalImgContainer.innerHTML = '';
          document.body.classList.remove('modal-open');
        });

        modal.addEventListener('click', (e) => {
          if (e.target === modal || e.target.classList.contains('modal-content')) {
            modal.classList.remove('show');
            modalImgContainer.innerHTML = '';
            document.body.classList.remove('modal-open');
          }
        });

        document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') {
             modal.classList.remove('show');
             modalImgContainer.innerHTML = '';
             document.body.classList.remove('modal-open');
            }
         });

        let paginaActual = 1;
        const resultadosPorPagina = 10;
        let totalPaginas = 1;

        function getDestacadas(array) {
          return array.filter(item => Number(item.nivel) === 5 && Number(item.subnivel1) === 1);
        }

        function buildPaginationBar(targetBar) {
          let html = '';
          const maxBtns = 7;
          let start = Math.max(1, paginaActual - Math.floor(maxBtns / 2));
          let end = start + maxBtns - 1;
          if (end > totalPaginas) {
            end = totalPaginas;
            start = Math.max(1, end - maxBtns + 1);
          }
          if (start > 1) {
            html += `<button onclick="cambiarPagina('primera')">1</button>`;
            if (start > 2) html += `<span class="dots">...</span>`;
          }
          for (let i = start; i <= end; i++) {
            if (i === paginaActual) {
              html += `<span class="active">${i}</span>`;
            } else {
              html += `<button onclick="irAPagina(${i})">${i}</button>`;
            }
          }
          if (end < totalPaginas) {
            if (end < totalPaginas - 1) html += `<span class="dots">...</span>`;
            html += `<button onclick="irAPagina(${totalPaginas})">${totalPaginas}</button>`;
          }
          targetBar.innerHTML = html;
        }

        function generarBloqueSucursales(item) {
          const sucursales = [];
          if (item.direccion || item.telefono) {
            sucursales.push({direccion: item.direccion,telefono: item.telefono});
          }
          if (item.direccion2 || item.telefono2) {
            sucursales.push({direccion: item.direccion2,telefono: item.telefono2});
          }
          if (item.direccion3 || item.telefono3) {
            sucursales.push({direccion: item.direccion3,telefono: item.telefono3});
          }
          return sucursales.map(suc => {
            let bloque = '';
            if (suc.direccion) bloque += `<div><i class="fas fa-map-marker-alt"></i> ${suc.direccion}</div>`;
            if (suc.telefono) bloque += `<div><i class="fas fa-phone"></i> ${suc.telefono}</div>`;
            return bloque;
          }).filter(Boolean).join('<div style="height:0.5em"></div>');
        }

        function renderWhatsapps(item) {
          const whatsapps = [];
          if (item.whatsapp) {
            whatsapps.push(`<a href="https://wa.me/${item.whatsapp.replace(/[^0-9]/g, '')}" target="_blank" rel="noopener noreferrer">${item.whatsapp}</a>`);
          }
          if (item.whatsapp2) {
            whatsapps.push(`<a href="https://wa.me/${item.whatsapp2.replace(/[^0-9]/g, '')}" target="_blank" rel="noopener noreferrer">${item.whatsapp2}</a>`);
          }
          if (whatsapps.length) {
            return `<div><i class="fab fa-whatsapp" style="color:#25D366;"></i> ${whatsapps.join(' ')}</div>`;
          }
          return '';
        }

        function extraerUsuarioRedSocial(url) {
          if (!url) return '';
          if (!/^https?:\/\//.test(url)) return url;
          try {
            const u = new URL(url);
            const parts = u.pathname.replace(/^\/+|\/+$/g, '').split('/');
            if(u.hostname.includes('youtube')) {
              if(parts[0].startsWith('@')) return parts[0];
              if(parts[0] === 'channel' || parts[0] === 'user' || parts[0] === 'c') return parts[1] || '';
              return parts[0] || '';
            }
            return parts[0] || '';
          } catch {
            return url;
          }
        }

        function renderCard(item) {
          const nivel = Number(item.nivel || 1);
          const logoComercio = (nivel > 1 && item.logo) ? `<img class="logo-comercio" src="${item.logo}" alt="Logo">` : '';
          const nombre = `<div class="nombre">${item.nombre}</div>`;
          const catLine = item.categoria ? `<div class="cat-line">${item.categoria}</div>` : '';
          let subcatLine = '';
          if (item.subcategoria1) {
            subcatLine = `<div class="subcat-line">${
              item.subcategoria1.split(",").map(sc => sc.trim()).join(' - ')
            }</div>`;
          }
          const spacerUnderSubcat = `<div class="spacer-under-subcat"></div>`;
          let termalesLogoHTML = '';
          const logos = {
            'Parque Termal': 'https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/parque-termal.png',
            'Termales Mall': 'https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/termales%20Mall.png'
          };
          const rubros = [
            ...(item.rubro1 ? item.rubro1.split(',').map(r => r.trim()) : []),
            ...(item.rubro2 ? item.rubro2.split(',').map(r => r.trim()) : [])
          ];
          const logosDetectados = Object.entries(logos)
            .filter(([nombreRubro]) => rubros.map(r => r.toLowerCase()).includes(nombreRubro.toLowerCase()))
            .map(([nombreRubro, urlImagen]) => {return `<img src="${urlImagen}" alt="Logo ${nombreRubro}" class="termales-logo" />`;}).join('');
          termalesLogoHTML = logosDetectados ? `<div class="termales-logo-container">${logosDetectados}</div>` : '';
          const imagenes = ['img1','img2','img3','img4','img5','img6'].map(k => item[k]).filter(Boolean);
          let galeria = '';
          if (imagenes.length > 1) {
            galeria = '<div class="galeria-carrusel">' +
                imagenes.map(url =>
                  `<img class="thumbnail" src="${url}" alt="Imagen galería" onclick="mostrarModal('${url}')">`
                ).join('') +
              '</div>';
          } else if (imagenes.length === 1) {
            galeria = `<img class="thumbnail solo" src="${imagenes[0]}" alt="Imagen" onclick="mostrarModal('${imagenes[0]}')">`;
          }
          const descripcion = (item.descripcion ? `<div class="descripcion">${item.descripcion}</div>` : '');
          const adicionales = (item.adicionales ? `<div class="adicionales">${item.adicionales}</div>` : '');
          const espacioEntreBloques = `<div style="height:0.5em;"></div>`;

          if (nivel === 1) {
            const whatsappPlano = [item.whatsapp, item.whatsapp2].filter(Boolean).map(w => `<div><i class="fab fa-whatsapp" style="color:#25D366;"></i> ${w}</div>`).join('');
            const sucursalesPlano = (() => {
              const sucursales = [];
              if (item.direccion || item.telefono) {
                sucursales.push({direccion: item.direccion,telefono: item.telefono});
              }
              if (item.direccion2 || item.telefono2) {
                sucursales.push({direccion: item.direccion2,telefono: item.telefono2});
              }
              if (item.direccion3 || item.telefono3) {
                sucursales.push({direccion: item.direccion3,telefono: item.telefono3});
              }
              return sucursales.map(suc => {
                let bloque = '';
                if (suc.direccion) bloque += `<div><i class="fas fa-map-marker-alt"></i> ${suc.direccion}</div>`;
                if (suc.telefono) bloque += `<div><i class="fas fa-phone"></i> ${suc.telefono}</div>`;
                return bloque;
              }).filter(Boolean).join('<div style="height:0.5em"></div>');
            })();
            let galeriaPlano = '';
            if (imagenes.length > 1) {
              galeriaPlano = '<div class="galeria-carrusel">' +
                  imagenes.map(url =>
                    `<img class="thumbnail" src="${url}" alt="Imagen galería">`
                  ).join('') +
                '</div>';
            } else if (imagenes.length === 1) {
              galeriaPlano = `<img class="thumbnail solo" src="${imagenes[0]}" alt="Imagen">`;
            }
            return `<div class="card nivel-${nivel}">
                ${nombre}
                ${espacioEntreBloques}
                ${descripcion}
                ${espacioEntreBloques}
                ${adicionales}
                ${espacioEntreBloques}
                ${galeriaPlano}
                <div class="contacto-bloque">${sucursalesPlano}${whatsappPlano}</div>
                ${termalesLogoHTML}
              </div>`;
          }
          if (nivel === 2) {
            let redesBloque = '';
            if (item.instagram) {
              let usuario = extraerUsuarioRedSocial(item.instagram);
              redesBloque += `<div>Instagram: ${usuario}</div>`;
            }
            if (item.facebook) {
              let usuario = extraerUsuarioRedSocial(item.facebook);
              redesBloque += `<div>Facebook: ${usuario}</div>`;
            }
            if (item.youtube) {
              let usuario = extraerUsuarioRedSocial(item.youtube);
              redesBloque += `<div>YouTube: ${usuario}</div>`;
            }
            if (redesBloque) redesBloque = `<div class="redes-bloque">${redesBloque}</div>`;
            const whatsappPlano = [item.whatsapp, item.whatsapp2].filter(Boolean).map(w => `<div><i class="fab fa-whatsapp" style="color:#25D366;"></i> ${w}</div>`).join('');
            const sucursalesPlano = (() => {
              const sucursales = [];
              if (item.direccion || item.telefono) {
                sucursales.push({direccion: item.direccion,telefono: item.telefono});
              }
              if (item.direccion2 || item.telefono2) {
                sucursales.push({direccion: item.direccion2,telefono: item.telefono2});
              }
              if (item.direccion3 || item.telefono3) {
                sucursales.push({direccion: item.direccion3,telefono: item.telefono3});
              }
              return sucursales.map(suc => {
                let bloque = '';
                if (suc.direccion) bloque += `<div><i class="fas fa-map-marker-alt"></i> ${suc.direccion}</div>`;
                if (suc.telefono) bloque += `<div><i class="fas fa-phone"></i> ${suc.telefono}</div>`;
                return bloque;
              }).filter(Boolean).join('<div style="height:0.5em"></div>');
            })();
            let galeriaPlano = '';
            if (imagenes.length > 1) {
              galeriaPlano = '<div class="galeria-carrusel">' +
                  imagenes.map(url =>
                    `<img class="thumbnail" src="${url}" alt="Imagen galería">`
                  ).join('') +
                '</div>';
            } else if (imagenes.length === 1) {
              galeriaPlano = `<img class="thumbnail solo" src="${imagenes[0]}" alt="Imagen">`;
            }
            return `<div class="card nivel-${nivel}">
                ${logoComercio}
                ${nombre}
                ${espacioEntreBloques}
                ${descripcion}
                ${espacioEntreBloques}
                ${adicionales}
                ${espacioEntreBloques}
                ${galeriaPlano}
                <div class="contacto-bloque">${sucursalesPlano}${whatsappPlano}</div>
                ${termalesLogoHTML}${redesBloque}
              </div>`;
          }
          const badges = [];
          if ((item.verificado || '').toLowerCase() === 'x') {
            badges.push('<img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/VERIFICADO.png" alt="Verificado">');
          }
          if ((item.gold || '').toLowerCase() === 'x') {
            badges.push('<img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/BEST.png" alt="Gold">');
          }
          let redesBloque = '';
          if (item.instagram && item.instagram.trim()) {
            const usuario = extraerUsuarioRedSocial(item.instagram);
            if (/^https?:\/\//.test(item.instagram)) {
              redesBloque += `<div><i class="fab fa-instagram" style="color:#E1306C; margin-right:5px;"></i><a href="${item.instagram}" target="_blank" rel="noopener noreferrer">${usuario}</a></div>`;
            } else {
              redesBloque += `<div><i class="fab fa-instagram" style="color:#E1306C; margin-right:5px;"></i>${usuario}</div>`;
            }
          }
          if (item.facebook && item.facebook.trim()) {
            const usuario = extraerUsuarioRedSocial(item.facebook);
            if (/^https?:\/\//.test(item.facebook)) {
              redesBloque += `<div><i class="fab fa-facebook" style="color:#1877F2; margin-right:5px;"></i><a href="${item.facebook}" target="_blank" rel="noopener noreferrer">${usuario}</a></div>`;
            } else {
              redesBloque += `<div><i class="fab fa-facebook" style="color:#1877F2; margin-right:5px;"></i>${usuario}</div>`;
            }
          }
          if (item.youtube && item.youtube.trim()) {
            const usuario = extraerUsuarioRedSocial(item.youtube);
            if (/^https?:\/\//.test(item.youtube)) {
              redesBloque += `<div><i class="fab fa-youtube" style="color:#FF0000; margin-right:5px;"></i><a href="${item.youtube}" target="_blank" rel="noopener noreferrer">${usuario}</a></div>`;
            } else {
              redesBloque += `<div><i class="fab fa-youtube" style="color:#FF0000; margin-right:5px;"></i>${usuario}</div>`;
            }
          }
          if (redesBloque) redesBloque = `<div class="redes-bloque">${redesBloque}</div>`;
          // ENLACE WEB: "Visitá nuestra web!"
          const webBloque = item.link ? `<div class="web-bloque"><div><i class="fas fa-globe" style="color:#006699; margin-right:5px;"></i><a href="${item.link}" target="_blank" rel="noopener noreferrer">Visitá nuestra web!</a></div></div>` : '';
          const mailBloque = item.mail ? `<div class="mail-bloque"><div><i class="fas fa-envelope" style="color:#006699; margin-right:5px;"></i><a href="mailto:${item.mail}">${item.mail}</a></div></div>` : '';
          let leyenda = '';
          if (nivel === 4) leyenda = `<div class="leyenda-nivel-4">ESPACIO GRATUITO</div>`;
          if (nivel === 3) leyenda = `<div class="leyenda-nivel-5">ESPACIO GRATUITO/BONIFICADO</div>`;
          let aiMapsValue = '';
          for (const key in item) {
            if (
              key.toLowerCase().includes('map') &&
              typeof item[key] === 'string' &&
              item[key].includes('http')
            ) {
              aiMapsValue = item[key];
              break;
            }
          }
          let comoLlegarBloque = '';
          if (nivel === 5 && aiMapsValue) {
            comoLlegarBloque = `
              <div style="margin-top:1em;">
                <a href="${aiMapsValue}" target="_blank" rel="noopener noreferrer" style="display:inline-flex;align-items:center;color:#006699;font-weight:bold;text-decoration:none;font-size:1.02em;">
                  <i class="fas fa-route" style="margin-right:0.4em;color:#d35400;font-size:1.3em;"></i>Cómo llegar
                </a>
              </div>
            `;
          }
          return `<div class="card nivel-${nivel}">
              <div class="badge-icons">${badges.join('')}</div>
              ${logoComercio}
              ${nombre}
              ${espacioEntreBloques}
              ${descripcion}
              ${espacioEntreBloques}
              ${adicionales}
              ${espacioEntreBloques}
              ${galeria}
              <div class="contacto-bloque">
                ${generarBloqueSucursales(item)}
                ${renderWhatsapps(item)}
              </div>
              ${termalesLogoHTML}
              ${redesBloque}
              ${webBloque}
              ${mailBloque}
              ${leyenda}
              ${comoLlegarBloque}
            </div>`;
        }
        function scrollTitulo() {
          const titulo = document.getElementById('titulo-principal');
          if (titulo) {titulo.scrollIntoView({behavior:'smooth',block:'start'});}
          else {window.scrollTo({top:0,behavior:'smooth'});}
        }
        function renderDestacadas(destacadas) {destacadasBar.innerHTML = destacadas.map(renderCard).join('');}
        function renderNormales(normales) {contenedor.innerHTML = normales.map(renderCard).join('');}
        window.irAPagina = function(num){paginaActual=num;render();scrollTitulo();}
        window.cambiarPagina = function(direccion){
          if (direccion === 'prev' && paginaActual > 1) {paginaActual--;}
          else if (direccion === 'next' && paginaActual < totalPaginas) {paginaActual++;}
          else if (direccion === 'primera') {paginaActual=1;}
          render();scrollTitulo();
        };

        // --- BUSCADOR POR TAGS ---
        buscadorTags.addEventListener('input', function() {
          const qTag = normalizar(buscadorTags.value.trim());
          if (qTag === '') {
            noTagsMsg.style.display = 'none';
            paginaActual = 1;
            render();
            return;
          }
          // Filtrado por tags
          const filtradoTag = turismoData.filter(item => {
            const tagsArr = (item.tags || '').split(',').map(tag => normalizar(tag.trim()));
            return tagsArr.some(tag => tag.includes(qTag));
          });
          if (filtradoTag.length) {
            noTagsMsg.style.display = 'none';
            mostrarSoloTag(filtradoTag);
          } else {
            noTagsMsg.style.display = '';
            contenedor.innerHTML = '';
            destacadasBar.innerHTML = '';
            paginationBar.innerHTML = '';
            btnAnterior.disabled = true;
            btnSiguiente.disabled = true;
          }
        });

        function mostrarSoloTag(array) {
          // Sin paginación, muestra todos los resultados de tags
          destacadasBar.innerHTML = '';
          contenedor.innerHTML = array.map(renderCard).join('');
          paginationBar.innerHTML = '';
          btnAnterior.disabled = true;
          btnSiguiente.disabled = true;
        }

        function render() {
          // Si hay algo en el buscador de tags, ignora render normal
          if (buscadorTags.value.trim() !== '') return;
          const q = normalizar(filtro.value);
          const categoriaSeleccionada = selectCategoria.value;
          const subcategoriaSeleccionada = selectSubcategoria.value;

          const destacadas = getDestacadas(turismoData);

          let filtrados = turismoData.filter(item => {
            let coincideCategoria = true;
            if (categoriaSeleccionada) {
              const rubros = [
                ...(item.rubro1 ? item.rubro1.split(',').map(r => r.trim()) : []),
                ...(item.rubro2 ? item.rubro2.split(',').map(r => r.trim()) : [])
              ];
              coincideCategoria = rubros.includes(categoriaSeleccionada);
            }
            let coincideSubcategoria = true;
            if (subcategoriaSeleccionada) {
              const subcats = (item.subcategoria1 || '').split(',').map(s => s.trim());
              coincideSubcategoria = subcats.includes(subcategoriaSeleccionada);
            }
            const coincideNombre = normalizar(item.nombre).includes(q);
            return coincideCategoria && coincideSubcategoria && coincideNombre;
          })
          .sort((a, b) => b.nivel - a.nivel || a.subnivel1 - b.subnivel1);

          const normales = filtrados.filter(item => !(Number(item.nivel) === 5 && Number(item.subnivel1) === 1));

          totalPaginas = Math.max(1, Math.ceil(normales.length / resultadosPorPagina));
          if (paginaActual > totalPaginas) paginaActual = totalPaginas;
          if (paginaActual < 1) paginaActual = 1;

          const inicio = (paginaActual - 1) * resultadosPorPagina;
          const fin = inicio + resultadosPorPagina;
          const normalesPaginadas = normales.slice(inicio, fin);

          btnAnterior.disabled = paginaActual === 1;
          btnSiguiente.disabled = paginaActual === totalPaginas;
          buildPaginationBar(paginationBar);

          renderDestacadas(destacadas);
          renderNormales(normalesPaginadas);
        }

        filtro.addEventListener('input', () => {
          paginaActual = 1;
          render();
        });

        render();

        window.addEventListener('scroll', () => {
          const topBtn = document.getElementById('topBtn');
          if (window.scrollY > 200) {topBtn.style.display = 'flex';}
          else {topBtn.style.display = 'none';}
        });
      })
      .catch(e => console.error('Error cargando datos:', e));
  </script>
</body>
</html>
