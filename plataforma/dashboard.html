function doGet(e) {
  var nombre = decodeURIComponent(e.parameter.nombre || "");
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("anunciantes");
  var data = sheet.getDataRange().getValues();
  var headers = data[0];
  var result = {};

  if (!nombre) {
    return ContentService.createTextOutput(JSON.stringify({error:"Falta el nombre"}))
      .setMimeType(ContentService.MimeType.JSON);
  }

  // Busca en columna B (índice 1)
  for (var i = 1; i < data.length; i++) {
    if (data[i][1] == nombre) { // columna B
      for (var j = 0; j < headers.length; j++) {
        result[headers[j]] = data[i][j];
      }
      return ContentService.createTextOutput(JSON.stringify(result))
        .setMimeType(ContentService.MimeType.JSON);
    }
  }
  return ContentService.createTextOutput(JSON.stringify({error:"No encontrado"}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  var nombre = decodeURIComponent(e.parameter.nombre || "");
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("anunciantes");
  var data = sheet.getDataRange().getValues();
  var headers = data[0];
  var params = JSON.parse(e.postData.contents);

  if (!nombre) {
    return ContentService.createTextOutput(JSON.stringify({error:"Falta el nombre"}))
      .setMimeType(ContentService.MimeType.JSON);
  }

  // Busca en columna B (índice 1)
  for (var i = 1; i < data.length; i++) {
    if (data[i][1] == nombre) { // columna B
      for (var j = 0; j < headers.length; j++) {
        if (params[headers[j]] !== undefined) {
          sheet.getRange(i+1, j+1).setValue(params[headers[j]]);
        }
      }
      return ContentService.createTextOutput(JSON.stringify({success:true}))
        .setMimeType(ContentService.MimeType.JSON);
    }
  }
  return ContentService.createTextOutput(JSON.stringify({error:"No encontrado"}))
    .setMimeType(ContentService.MimeType.JSON);
}
