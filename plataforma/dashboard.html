<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel de Comercio - Guia Local Dolores</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin:0; padding:0;}
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 32px 40px 28px 40px;}
    h1, h2 { text-align:center; }
    .bienvenida { margin: 24px 0 16px 0; text-align: center; font-size: 1.15em; color: #444;}
    .panel-bloque { background: #e7f7fd; padding:22px; border-radius:8px; margin-bottom: 26px;}
    .btn { display: inline-block; padding: 14px 30px; border-radius:6px; background: #3dc879; color:#fff; font-weight:bold; border:none; cursor:pointer; font-size: 1.1em; margin: 10px 0;}
    .btn2 { background: #3498db;}
    .info { background: #fffbe5; padding: 12px; border-radius: 8px; margin: 20px 0; color: #555;}
    .logout { position: absolute; top: 18px; right: 40px; }
    .stats-table { width:100%; border-collapse: collapse; margin:18px 0;}
    .stats-table th, .stats-table td { padding:10px; border-bottom: 1px solid #ddd; text-align:left;}
    .stats-title { margin-top: 18px; font-weight: bold; color: #333; }
    .historial { background: #f7f7f7; padding:10px; border-radius:6px; margin-top:10px;}
    .enlaces { margin-top:16px; }
    .enlaces a { color: #3498db; text-decoration: underline; margin-right: 18px;}
    .footer { text-align:center; color:#aaa; font-size:0.9em; margin-top: 32px;}
    @media (max-width: 700px) {
      .container { padding:14px; }
      .logout { right: 12px; }
    }
  </style>
</head>
<body>
  <div class="container" style="display:none;" id="panel-container">
    <button class="btn logout" onclick="logout()">Cerrar sesión</button>
    <h1>Panel de Comercio</h1>
    <div class="bienvenida" id="bienvenida">
      Bienvenido/a <span id="comercio-nombre">[Tu Comercio]</span>
    </div>
    <div class="panel-bloque">
      <h2>Mi Comercio</h2>
      <div id="comercio-info">
        <div class="info">
          <b>Datos del comercio:</b><br>
          <span id="comercio-datos">-</span>
        </div>
        <button class="btn" onclick="editarDatos()">Editar datos del comercio</button>
      </div>
      <div class="stats-title">Estadísticas del perfil</div>
      <table class="stats-table">
        <tr><th>Visitas este mes</th><td id="stats-visitas">0</td></tr>
        <tr><th>Consultas recibidas</th><td id="stats-consultas">0</td></tr>
        <tr><th>Última actualización</th><td id="stats-actualizacion">-</td></tr>
      </table>
      <div class="historial">
        <b>Historial de accesos:</b>
        <ul id="historial-accesos">
          <li>-</li>
        </ul>
      </div>
    </div>
    <div class="panel-bloque">
      <h2>Enlaces útiles</h2>
      <div class="enlaces">
        <a href="https://guialocaldolores.com.ar/" target="_blank">Ver perfil público</a>
        <a href="mailto:contacto@guialocaldolores.com.ar">Soporte</a>
        <a href="https://www.guialocaldolores.com.ar/anunciantes/panel/" target="_blank">Recargar panel</a>
      </div>
    </div>
    <div class="panel-bloque">
      <h2>Consultas y Soporte</h2>
      <p>¿Necesitás ayuda? Escribinos a <b>contacto@guialocaldolores.com.ar</b></p>
      <button class="btn btn2" onclick="window.open('mailto:contacto@guialocaldolores.com.ar')">Enviar consulta</button>
    </div>
    <div class="footer">
      &copy; 2025 Guia Local Dolores &mdash; Todos los derechos reservados.
    </div>
  </div>
  <div id="nologin" style="text-align:center; margin-top:50px; color:#b00; font-size:1.2em; display:none;">
    Debés iniciar sesión para ver el panel.<br>
    <a href="https://www.guialocaldolores.com.ar/anunciantes/login/" target="_top">Ir al login</a>
  </div>
  <script>
    // Pedimos login al padre
    window.parent.postMessage({ type: "pedirLogin" }, "*");

    window.addEventListener("message", function(event){
      if (event.data && event.data.type === "datosLogin") {
        if (event.data.comercio_id && event.data.comercio_nombre) {
          mostrarPanel(event.data.comercio_id, event.data.comercio_nombre);
        } else {
          document.getElementById("nologin").style.display = "block";
        }
      }
    });

    function mostrarPanel(comercio_id, comercio_nombre) {
      document.getElementById("panel-container").style.display = "block";
      document.getElementById('comercio-nombre').textContent = comercio_nombre;
      var datos = "Nombre: " + comercio_nombre + "<br>Localidad: Dolores<br>Actividad: Comercio/Servicio";
      document.getElementById('comercio-datos').innerHTML = datos;
      document.getElementById('stats-visitas').textContent = Math.floor(20 + Math.random()*80);
      document.getElementById('stats-consultas').textContent = Math.floor(5 + Math.random()*15);
      document.getElementById('stats-actualizacion').textContent = "18/09/2025";
      var historial = ["18/09/2025 09:20", "15/09/2025 17:51", "09/09/2025 12:12"];
      document.getElementById('historial-accesos').innerHTML = historial.map(function(item){return "<li>"+item+"</li>";}).join("");
    }

    function logout() {
      // Avisamos al padre para cerrar sesión
      window.parent.postMessage({ type: "logout" }, "*");
      document.getElementById("panel-container").style.display = "none";
      document.getElementById("nologin").style.display = "block";
    }
  </script>
</body>
</html>
