<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Guía Local Dolores</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #f9fafb;
    }
    .card:hover {
      transform: translateY(-2px);
      transition: all 0.2s ease-in-out;
    }
  </style>
</head>
<body class="p-6 font-sans">
  <h1 class="text-3xl font-bold mb-6 text-center text-blue-800">Guía Local Dolores</h1>

  <div class="grid md:grid-cols-2 gap-4 mb-6 max-w-4xl mx-auto">
    <select id="rubro" class="p-3 border rounded w-full">
      <option value="">Seleccionar Rubro</option>
    </select>
    <select id="categoria" class="p-3 border rounded w-full">
      <option value="">Seleccionar Categoría</option>
    </select>
  </div>

  <div class="text-center mb-10">
    <button id="buscar" class="bg-blue-700 text-white px-6 py-2 rounded hover:bg-blue-800">Buscar</button>
  </div>

  <div id="resultados" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 px-4 max-w-6xl mx-auto"></div>

  <div class="text-center mt-8" id="paginacion"></div>

  <script>
    const SHEET_URL = 'https://gsx2json.com/api?id=170kTZ-ViCPxPli86g-n_XMuMv1S3O0-DbGwNFGYVnjY';
    const RUBRO_URLS = {
      'Gobierno': 'https://www.guialocaldolores.com.ar/gobierno',
      'Industria': 'https://www.guialocaldolores.com.ar/industria',
      'Turismo': 'https://www.guialocaldolores.com.ar/turismo',
      'Salud': 'https://www.guialocaldolores.com.ar/salud',
      'Educación': 'https://www.guialocaldolores.com.ar/educacion',
      'Comercio': 'https://www.guialocaldolores.com.ar/comercio',
      // Podés agregar más rubros con sus URLs si querés
    };

    let data = [];
    let paginaActual = 1;
    const porPagina = 10;
    let resultadosFiltrados = [];

    async function cargarDatos() {
      const res = await fetch(SHEET_URL);
      const json = await res.json();
      data = json.rows;

      const rubros = new Set();
      const categorias = new Set();

      data.forEach(d => {
        if (d.rubro1) rubros.add(d.rubro1.trim());
        if (d.rubro2) rubros.add(d.rubro2.trim());
        if (d.subcategoria1) categorias.add(d.subcategoria1.trim());
      });

      [...rubros].sort().forEach(r => {
        const opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        document.getElementById('rubro').appendChild(opt);
      });

      [...categorias].sort().forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        document.getElementById('categoria').appendChild(opt);
      });
    }

    function filtrar() {
      const rubroSel = document.getElementById('rubro').value;
      const catSel = document.getElementById('categoria').value;

      resultadosFiltrados = data.filter(d =>
        (!rubroSel || d.rubro1 === rubroSel || d.rubro2 === rubroSel) &&
        (!catSel || d.subcategoria1 === catSel)
      );

      paginaActual = 1;
      mostrarResultados();
    }

    function mostrarResultados() {
      const cont = document.getElementById('resultados');
      cont.innerHTML = '';

      const inicio = (paginaActual - 1) * porPagina;
      const fin = inicio + porPagina;
      const paginaItems = resultadosFiltrados.slice(inicio, fin);

      if (paginaItems.length === 0) {
        cont.innerHTML = '<p class="text-center text-gray-500 col-span-full">No se encontraron resultados.</p>';
        document.getElementById('paginacion').innerHTML = '';
        return;
      }

      paginaItems.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card bg-white rounded shadow p-4';

        const rubroKey = (item.rubro1 || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, '');
        const imagenUrl = `https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/${rubroKey}/logo.jpg`;

        card.innerHTML = `
          <div class="flex items-center mb-2">
            <img src="${imagenUrl}" alt="${item.rubro1}" class="w-10 h-1
