<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Listado con Niveles</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 1rem;
  }
  .card {
    border: 1px solid #ccc;
    padding: 1rem;
    margin-bottom: 1rem;
    position: relative;
  }
  .nivel-1 .thumbnail {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    cursor: pointer;
  }
  /* Ajuste para logo niveles 2 y 3 */
  .logo-img {
    display: block;
    margin: 0 auto 1rem auto;
    max-width: 90vw;
    max-height: 200px;
    object-fit: contain;
    cursor: pointer;
  }
  .bloque {
    margin-top: 0.5rem;
  }
  .bloque.contacto, .bloque.redes, .bloque.web {
    font-size: 0.9rem;
  }
  .bloque.redes a, .bloque.web a {
    color: #0073e6;
    text-decoration: none;
  }
  .carousel img {
    width: 80px;
    height: 80px;
    margin: 0 0.3rem;
    object-fit: cover;
    cursor: pointer;
  }
  /* Modal styles */
  #modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
  }
  #modal img {
    max-width: 90vw;
    max-height: 90vh;
  }
  #modal .cerrar {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 2rem;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<div>
  <label>Filtro: <input id="filtro" type="text" /></label>
  <label>Categoría:
    <select id="categoria"></select>
  </label>
  <label>Subcategoría:
    <select id="subcategoria"></select>
  </label>
</div>

<div id="contenedor"></div>

<!-- Modal para imagen -->
<div id="modal" aria-modal="true" role="dialog">
  <span class="cerrar" aria-label="Cerrar">&times;</span>
  <img alt="Imagen ampliada" />
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filtro = document.getElementById('filtro');
    const categoriaSelect = document.getElementById('categoria');
    const subcategoriaSelect = document.getElementById('subcategoria');
    const contenedor = document.getElementById('contenedor');
    const modal = document.getElementById('modal');
    const modalImg = modal.querySelector('img');
    const modalCerrar = modal.querySelector('.cerrar');

    // Datos de ejemplo para ilustrar
    const datos = [
      // Nivel 1
      {
        nivel: 1,
        nombre: "Item Nivel 1",
        descripcion: "Descripción nivel 1",
        categoria: "Cat1",
        subcategoria: "Sub1",
        foto: "https://via.placeholder.com/400x200?text=Nivel+1",
        adicionales: "",
        telefono: "123456789",
        mail: "email1@example.com",
        whatsapp: "123456789",
        facebook: "https://facebook.com/item1",
        instagram: "https://instagram.com/item1",
        web: "https://example.com/item1"
      },
      // Nivel 2
      {
        nivel: 2,
        nombre: "Item Nivel 2",
        descripcion: "Descripción nivel 2",
        categoria: "Cat1",
        subcategoria: "Sub2",
        logo: "https://via.placeholder.com/300x150?text=Logo+Nivel+2",
        adicionales: "Datos adicionales",
        telefono: "987654321",
        mail: "email2@example.com",
        whatsapp: "987654321",
        facebook: "",
        instagram: "",
        web: ""
      },
      // Nivel 3 con carrusel y logo
      {
        nivel: 3,
        nombre: "Item Nivel 3",
        descripcion: "Descripción nivel 3",
        categoria: "Cat2",
        subcategoria: "Sub3",
        logo: "https://via.placeholder.com/250x100?text=Logo+Nivel+3",
        fotos_carrusel: "https://via.placeholder.com/80?text=1, https://via.placeholder.com/80?text=2, https://via.placeholder.com/80?text=3",
        adicionales: "",
        telefono: "",
        mail: "",
        whatsapp: "",
        facebook: "https://facebook.com/item3",
        instagram: "",
        web: "https://example.com/item3"
      }
    ];

    // Llenar opciones de categoria y subcategoria
    const categorias = [...new Set(datos.map(d => d.categoria))];
    categorias.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      categoriaSelect.appendChild(opt);
    });

    function updateSubcategorias() {
      const catSel = categoriaSelect.value;
      const subs = [...new Set(datos.filter(d => d.categoria === catSel).map(d => d.subcategoria))];
      subcategoriaSelect.innerHTML = '<option value="">Todas</option>';
      subs.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s;
        subcategoriaSelect.appendChild(opt);
      });
    }

    function mostrarModal(src) {
      modal.style.display = 'flex';
      modalImg.src = src;
    }

    modalCerrar.onclick = () => {
      modal.style.display = 'none';
      modalImg.src = '';
    };

    modal.onclick = (e) => {
      if(e.target === modal) {
        modal.style.display = 'none';
        modalImg.src = '';
      }
    };

    function render() {
      const filtroTexto = filtro.value.toLowerCase();
      const catSel = categoriaSelect.value;
      const subSel = subcategoriaSelect.value;

      contenedor.innerHTML = '';

      datos.filter(item => {
        if(filtroTexto && !item.nombre.toLowerCase().includes(filtroTexto)) return false;
        if(catSel && item.categoria !== catSel) return false;
        if(subSel && item.subcategoria !== subSel) return false;
        return true;
      }).forEach(item => {
        const nivel = item.nivel;

        // Bloque categoria
        const bloqueCategoria = document.createElement('div');
        bloqueCategoria.className = 'bloque categoria';
        bloqueCategoria.textContent = item.categoria;

        // Bloque adicionales
        if(item.adicionales) {
          const adicionalesElem = document.createElement('span');
          adicionalesElem.className = 'adicionales';
          adicionalesElem.textContent = item.adicionales;
          bloqueCategoria.appendChild(adicionalesElem);
        }

        // Bloque contacto
        const bloqueContacto = document.createElement('div');
        bloqueContacto.className = 'bloque contacto';
        if(item.telefono) bloqueContacto.innerHTML = `Tel: ${item.telefono}`;
        if(item.mail) bloqueContacto.innerHTML += `<br/>Mail: <a href="mailto:${item.mail}">${item.mail}</a>`;
        if(item.whatsapp) bloqueContacto.innerHTML += `<br/>WhatsApp: ${item.whatsapp}`;

        // Bloque redes
        const bloqueRedes = document.createElement('div');
        bloqueRedes.className = 'bloque redes';
        if(item.facebook) bloqueRedes.innerHTML += `Facebook: <a href="${item.facebook}" target="_blank" rel="noopener">${item.facebook}</a><br/>`;
        if(item.instagram) bloqueRedes.innerHTML += `Instagram: <a href="${item.instagram}" target="_blank" rel="noopener">${item.instagram}</a>`;

        // Bloque web
        const bloqueWeb = document.createElement('div');
        bloqueWeb.className = 'bloque web';
        if(item.web) bloqueWeb.innerHTML = `Web: <a href="${item.web}" target="_blank" rel="noopener">${item.web}</a>`;

        // Imagen logo niveles 2 y 3 (centrado, ajustado)
        let logoElem = null;
        if ((nivel === 2 || nivel === 3) && item.logo) {
          logoElem = document.createElement('img');
          logoElem.className = 'logo-img';
          logoElem.src = item.logo;
          logoElem.alt = `Logo de ${item.nombre}`;
          logoElem.loading = 'lazy';
          logoElem.onclick = () => mostrarModal(item.logo);
        }

        // Imagen thumbnail para nivel 1 (con zoom)
        let thumbnail = null;
        if (nivel === 1 && item.foto) {
          thumbnail = document.createElement('img');
          thumbnail.className = 'thumbnail';
          thumbnail.src = item.foto;
          thumbnail.alt = `Imagen de ${item.nombre}`;
          thumbnail.loading = 'lazy';
          thumbnail.onclick = () => mostrarModal(item.foto);
        }

        // Para nivel 3, mostrar imágenes en carrusel si tiene más fotos
        let carousel = null;
        if (nivel === 3 && item.fotos_carrusel) {
          const fotos = item.fotos_carrusel.split(',').map(s => s.trim()).filter(Boolean);
          if (fotos.length > 0) {
            carousel = document.createElement('div');
            carousel.className = 'carousel';
            fotos.forEach(src => {
              const img = document.createElement('img');
              img.src = src;
              img.alt = `Imagen adicional de ${item.nombre}`;
              img.loading = 'lazy';
              img.onclick = () => mostrarModal(src);
              carousel.appendChild(img);
            });
          }
        }

        const card = document.createElement('article');
        card.className = `card nivel-${nivel}`;

        // Agregar logo si existe (nivel 2 y 3)
        if (logoElem) card.appendChild(logoElem);
        // Agregar thumbnail si existe (nivel 1)
        if (thumbnail) card.appendChild(thumbnail);

        const nombreElem = document.createElement('div');
        nombreElem.className = 'nombre';
        nombreElem.textContent = item.nombre;

        const descElem = document.createElement('div');
        descElem.className = 'descripcion';
        descElem.textContent = item.descripcion;

        card.appendChild(nombreElem);
        card.appendChild(bloqueCategoria);
        card.appendChild(descElem);
        card.appendChild(bloqueContacto);
        card.appendChild(bloqueRedes);
        card.appendChild(bloqueWeb);

        if (carousel) card.appendChild(carousel);

        contenedor.appendChild(card);
      });
    }

    filtro.addEventListener('input', render);
    categoriaSelect.addEventListener('change', () => {
      updateSubcategorias();
      render();
    });
    subcategoriaSelect.addEventListener('change', render);

    updateSubcategorias();
    render();
  });
</script>

</body>
</html>
