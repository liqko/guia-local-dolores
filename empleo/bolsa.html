<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Bolsa de Empleo - CVs y Ofertas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin:0; font-family:'Segoe UI',Arial,sans-serif; background:#f4fcfd; color:#01434c;}
    .main-content {
      max-width: 1000px; 
      margin:38px auto 22px auto; 
      background:#ecfdff; 
      border-radius:22px; 
      border:2.5px solid #00bcd4; 
      box-shadow:0 8px 38px rgba(0,151,167,0.09); 
      padding:26px 24px 18px 24px;
    }
    .logo-bolsa {display:block; margin:0 auto 14px auto; max-width:104px; width:32vw;}
    h1 {text-align:center; color:#00bcd4; margin:0 0 16px 0; font-size:1.5em;}
    .intro {font-size:1.09em; color:#006064; margin-bottom:8px;}
    .separador-p {margin-bottom:18px;}
    h2 {color:#0097a7; margin:38px 0 8px 0; font-size:1.22em;}
    .seccion {margin-bottom:40px;}
    .cards {display:flex; flex-direction:column; gap:20px; margin-top:13px;}
    .card {
      background:#fff; border-radius:15px; box-shadow:0 2px 14px #b2ebf255; border:1.5px solid #b2ebf2;
      padding:18px 16px 12px 16px; width:100%; min-width:260px; max-width:100%;
      display:flex; flex-direction:row; align-items:flex-start; gap:18px;
    }
    .card-cv .cv-foto {
      max-width:70px; max-height:70px; border-radius:14px; border:1.5px solid #b2ebf2; margin-bottom:7px; margin-top:3px;
      object-fit:cover; background:#ecfdff;
      flex-shrink:0;
    }
    .card-info {display:flex; flex-direction:column; gap:4px; width:100%;}
    .card-titulo {font-weight:bold; color:#007c91; font-size:1.09em;}
    .card-label {color:#0097a7; font-weight:bold; margin-right:4px;}
    .card-presentacion, .card-descripcion {font-size:0.99em; color:#636363;}
    .card-zona {font-size:0.98em; color:#888; margin-top:2px;}
    .card-email {font-size:0.99em; margin-top:4px;}
    .card-email a {color:#007c91; text-decoration:underline; font-weight:bold;}
    .nada {color:#b71c1c; margin:23px 0 0 0; text-align:center;}
    .tabs {
      display: flex;
      justify-content: center;
      margin: 30px 0 10px 0;
      gap: 10px;
    }
    .tab-btn {
      background: #fff;
      color: #0097a7;
      border: 1.5px solid #00bcd4;
      border-radius: 12px 12px 0 0;
      font-size: 1.11em;
      font-weight: bold;
      padding: 9px 28px;
      cursor: pointer;
      margin: 0 2px;
      transition: background 0.13s, color 0.13s;
      outline: none;
    }
    .tab-btn.active, .tab-btn:focus {
      background: linear-gradient(90deg, #00bcd4 60%, #00acc1 100%);
      color: #fff;
      border-bottom: 2.5px solid #ecfdff;
      z-index: 2;
    }
    .tab-content {display:none;}
    .tab-content.active {display:block;}
    .paginator {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
      margin-top: 12px;
    }
    .paginator button {
      padding: 7px 18px;
      font-size: 1em;
      border: none;
      background: #00bcd4;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 7px rgba(44,60,90,0.07);
      font-style: italic;
    }
    .paginator button[disabled] {
      background: #b2ebf2;
      cursor: not-allowed;
    }
    .paginator .page-info {
      font-size: 1.06em;
      color: #01434c;
      font-weight: 500;
      min-width: 55px;
      text-align: center;
    }
    .btn-eliminar {
      background: linear-gradient(90deg, #d32f2f 60%, #b71c1c 100%);
      color: #fff;
      font-size: 1.07em;
      font-weight: bold;
      border: none;
      border-radius: 14px;
      padding: 14px 0;
      margin: 25px 0 15px 0;
      cursor: pointer;
      box-shadow: 0 3px 13px rgba(211,47,47,0.13);
      width: 100%;
      letter-spacing: 0.04em;
      transition: background 0.15s, box-shadow 0.15s;
      display: block;
      text-align: center;
      text-decoration: none;
    }
    .btn-eliminar:hover {
      background: linear-gradient(90deg, #b71c1c 60%, #d32f2f 100%);
      box-shadow: 0 4px 18px rgba(211,47,47,0.24);
      color: #ffe082;
    }
    .eliminar-aviso {
      margin: 10px 0 30px 0;
      text-align: center;
      font-size: 1.03em;
      color: #d32f2f;
      font-weight: bold;
    }
    .eliminar-aviso small {
      display: block;
      color: #444;
      font-weight: normal;
      margin-top: 3px;
      font-size: 0.98em;
    }
    .zocalo {
      width:100%;
      background:linear-gradient(90deg,#00bcd4 60%,#00acc1 100%);
      border-radius:17px;
      margin-top:32px;
      min-height:74px;
      display:flex;
      flex-direction:column;
      align-items:center;
      box-shadow:0 -3px 18px #00bcd444;
      padding:9px 0 3px 0;
      position:relative;
      gap:0;
    }
    .zocalo-mensaje {
      width:100%;
      text-align:center;
      color:#fff;
      font-size:1.05em;
      font-weight:500;
      margin-bottom:5px;
      margin-top:8px;
      letter-spacing:0.01em;
      text-shadow:0 2px 8px #00bcd455;
    }
    .zocalo-links {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:38px;
      width:100%;
    }
    .zocalo-link {
      display:flex;
      flex-direction:column;
      align-items:center;
      color:#fff;
      text-decoration:none;
      font-size:1em;
      font-weight:bold;
      transition:color 0.18s;
      min-width:82px;
    }
    .zocalo-link img {
      width:32px; height:32px; margin-bottom:2px; border-radius:8px; background:#fff; box-shadow:0 2px 10px rgba(0,188,212,0.07);
      object-fit:contain;
      display:block;
    }
    .zocalo-link:hover {color:#ffe082;}
    .zocalo-link:hover img {box-shadow:0 0 0 2px #ffe082;}
    @media (max-width: 900px) {.main-content{padding:13px 2vw 7vw 2vw;} .card{width:100%; min-width:0;}}
    @media (max-width: 600px) {
      .main-content{max-width:99vw;}
      .zocalo-links{gap:0; justify-content:space-around;}
      .zocalo{font-size:0.97em;}
      .zocalo-link{min-width:48px; font-size:0.93em;}
      .zocalo-link img{width:22vw; height:22vw; max-width:48px; max-height:48px;}
      .card {flex-direction: column; align-items: stretch;}
      .card-cv .cv-foto {margin: 0 auto 9px auto;}
    }
  </style>
</head>
<body>
  <div class="main-content">
    <img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/bolsa-empleo.png" alt="Bolsa de Empleo Dolores" class="logo-bolsa">
    <h1>Bolsa de Empleo</h1>
    <p class="intro separador-p">
      Encontrá oportunidades laborales en Dolores o publicá tu perfil para que te contacten empleadores de la ciudad y la zona.
    </p>

    <a class="btn-eliminar" href="https://www.guialocaldolores.com.ar/empleo/eliminar-cv-oferta/" target="_top">
      ELIMINAR MI CV / OFERTA LABORAL
    </a>
    <div class="eliminar-aviso">
      Para eliminar tu publicación, debés hacerlo con el email registrado.<br>
      Si tenés dudas, escribinos a <a href="mailto:hola@guialocaldolores.com.ar">hola@guialocaldolores.com.ar</a>
      <small>(Esto aplica tanto para CVs como para ofertas laborales).</small>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="cv">CVs publicados</button>
      <button class="tab-btn" data-tab="oferta">Ofertas laborales</button>
    </div>

    <!-- TAB CV -->
    <div id="tab-cv" class="tab-content active">
      <input type="text" id="buscar-cv" class="search-box" placeholder="Buscar CV por puesto, área, zona...">
      <div class="cards" id="cv-cards"></div>
      <div class="nada" id="cv-vacio" style="display:none;">No hay CVs publicados aún.</div>
      <div class="paginator" id="cv-paginator"></div>
    </div>

    <!-- TAB OFERTAS -->
    <div id="tab-oferta" class="tab-content">
      <input type="text" id="buscar-oferta" class="search-box" placeholder="Buscar oferta por puesto, área, zona, empresa...">
      <div class="cards" id="oferta-cards"></div>
      <div class="nada" id="oferta-vacio" style="display:none;">No hay ofertas activas en este momento.</div>
      <div class="paginator" id="oferta-paginator"></div>
    </div>

    <div class="zocalo">
      <div class="zocalo-mensaje">
        Publicá tu CV u Oferta Laboral de forma segura y sin datos sensibles.
      </div>
      <div class="zocalo-links">
        <a class="zocalo-link" href="https://www.guialocaldolores.com.ar/empleo/cv/" title="Cargar mi CV" target="_top">
          <img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/cv.png" alt="Cargar CV" />
          Cargar CV
        </a>
        <a class="zocalo-link" href="https://www.guialocaldolores.com.ar/empleo/oferta/" title="Publicar Oferta" target="_top">
          <img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/bolsa-empleo.png" alt="Publicar Oferta" />
          Publicar oferta
        </a>
        <a class="zocalo-link" href="https://www.guialocaldolores.com.ar/" title="Ir al Inicio de la plataforma" target="_top">
          <img src="https://raw.githubusercontent.com/liqko/guia-local-dolores/refs/heads/main/img/plataforma/inicio.png" alt="Ir al Inicio de la plataforma" />
          Inicio
        </a>
      </div>
    </div>
  </div>
  <script>
    // Helpers
    const gsURL = 'https://script.google.com/macros/s/AKfycbwSLK_DrrYSABf1d7VWCQvxUG3mZS5TYnaqOCdi1plRFKSkM59CKM_r2vBIFLLRD6vexw/exec';
    let cvsData = [], ofertasData = [];
    let paginaCV = 1, paginaOferta = 1;
    const porPagina = 10;

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('tab-'+this.getAttribute('data-tab')).classList.add('active');
      });
    });

    // Util para foto Google Drive
    function procesarEnlaceFoto(url) {
      if (!url) return '';
      let match = url.match(/drive\.google\.com\/file\/d\/([^/]+)\//);
      if (match && match[1]) {
        return "https://drive.google.com/uc?export=view&id=" + match[1];
      }
      return url;
    }

    function renderCVs(datos, pagina=1, filtro="") {
      const cards = document.getElementById('cv-cards');
      cards.innerHTML = "";
      let filtrados = datos.filter(cv => {
        if (!filtro) return true;
        const texto = [
          cv.nombre, cv.puesto, cv.area, cv.categoria, cv.presentacion, cv.experiencia, cv.educacion, cv.zona
        ].map(x=>x||'').join(" ").toLowerCase();
        return texto.includes(filtro.toLowerCase());
      });
      const total = filtrados.length;
      const totalPaginas = Math.ceil(total / porPagina) || 1;
      const inicio = (pagina-1)*porPagina;
      const fin = inicio + porPagina;
      filtrados.slice(inicio, fin).forEach(cv => {
        console.log("Foto:", cv.foto, "Procesada:", procesarEnlaceFoto(cv.foto));
        let foto = cv.foto ? `<img class="cv-foto" src="${procesarEnlaceFoto(cv.foto)}" alt="Foto">` : '';
        let html = `<div class="card card-cv">
          ${foto}
          <div class="card-info">
            <div><span class="card-label">NOMBRE:</span> ${cv.nombre || '-'}</div>
            <div><span class="card-label">ÁREA DE TRABAJO:</span> ${cv.area || '-'}</div>
            <div><span class="card-label">CATEGORÍA:</span> ${cv.categoria || '-'}</div>
            <div><span class="card-label">PUESTO DESEADO:</span> ${cv.puesto || '-'}</div>
            <div><span class="card-label">ZONA:</span> ${cv.zona || '-'}</div>
            <div><span class="card-label">PRESENTACIÓN:</span> <span class="card-presentacion">${cv.presentacion || '-'}</span></div>
            <div><span class="card-label">EXPERIENCIA:</span> ${cv.experiencia || '-'}</div>
            <div><span class="card-label">EDUCACIÓN:</span> ${cv.educacion || '-'}</div>
            <div class="card-email"><span class="card-label">CONTACTO:</span> 
              ${cv.email ? `<a href="mailto:${cv.email}">${cv.email}</a>` : '-'}
            </div>
          </div>
        </div>`;
        cards.innerHTML += html;
      });
      document.getElementById('cv-vacio').style.display = (total === 0) ? '' : 'none';
      renderPaginator("cv", total, pagina, totalPaginas);
    }

    function renderOfertas(datos, pagina=1, filtro="") {
      const cards = document.getElementById('oferta-cards');
      cards.innerHTML = "";
      let filtrados = datos.filter(of => {
        if (!filtro) return true;
        const texto = [
          of.titulo, of.area, of.descripcion, of.empresa, of.requisitos, of.zona
        ].map(x=>x||'').join(" ").toLowerCase();
        return texto.includes(filtro.toLowerCase());
      });
      const total = filtrados.length;
      const totalPaginas = Math.ceil(total / porPagina) || 1;
      const inicio = (pagina-1)*porPagina;
      const fin = inicio + porPagina;
      filtrados.slice(inicio, fin).forEach(of => {
        let html = `<div class="card card-oferta">
          <div class="card-info">
            <div><span class="card-label">TÍTULO DEL PUESTO:</span> ${of.titulo || '-'}</div>
            <div><span class="card-label">ÁREA DE TRABAJO:</span> ${of.area || '-'}</div>
            <div><span class="card-label">DESCRIPCIÓN:</span> <span class="card-descripcion">${of.descripcion || '-'}</span></div>
            <div><span class="card-label">EMPRESA:</span> ${of.empresa || '-'}</div>
            <div><span class="card-label">REQUISITOS:</span> ${of.requisitos || '-'}</div>
            <div><span class="card-label">ZONA DE TRABAJO:</span> ${of.zona || '-'}</div>
            <div class="card-email"><span class="card-label">CONTACTO:</span> 
              ${of.email ? `<a href="mailto:${of.email}">${of.email}</a>` : '-'}
            </div>
          </div>
        </div>`;
        cards.innerHTML += html;
      });
      document.getElementById('oferta-vacio').style.display = (total === 0) ? '' : 'none';
      renderPaginator("oferta", total, pagina, totalPaginas);
    }

    function renderPaginator(tipo, total, pagina, totalPaginas) {
      const pagDiv = document.getElementById(tipo + '-paginator');
      if (totalPaginas <= 1) { pagDiv.innerHTML = ""; return; }
      pagDiv.innerHTML = `
        <button ${pagina <= 1 ? "disabled" : ""} onclick="cambiarPagina('${tipo}', ${pagina-1})">Anterior</button>
        <span class="page-info">Página ${pagina} / ${totalPaginas}</span>
        <button ${pagina >= totalPaginas ? "disabled" : ""} onclick="cambiarPagina('${tipo}', ${pagina+1})">Siguiente</button>
      `;
    }

    window.cambiarPagina = function(tipo, nuevaPag) {
      if (tipo === "cv") { 
        paginaCV = nuevaPag; 
        renderCVs(cvsData, paginaCV, document.getElementById('buscar-cv').value); 
      }
      if (tipo === "oferta") { 
        paginaOferta = nuevaPag; 
        renderOfertas(ofertasData, paginaOferta, document.getElementById('buscar-oferta').value); 
      }
    }

    document.getElementById('buscar-cv').addEventListener('input', function() {
      paginaCV = 1;
      renderCVs(cvsData, paginaCV, this.value);
    });

    document.getElementById('buscar-oferta').addEventListener('input', function() {
      paginaOferta = 1;
      renderOfertas(ofertasData, paginaOferta, this.value);
    });

    fetch(gsURL+'?tipo=cv')
      .then(r=>r.text())
      .then(txt=>{
        try { cvsData = JSON.parse(txt); }
        catch { cvsData = []; }
        renderCVs(cvsData, paginaCV, "");
      });

    fetch(gsURL+'?tipo=oferta')
      .then(r=>r.text())
      .then(txt=>{
        try { ofertasData = JSON.parse(txt); }
        catch { ofertasData = []; }
        renderOfertas(ofertasData, paginaOferta, "");
      });
  </script>
</body>
</html>
